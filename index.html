<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>Konfigurator Bombki 3D</title>
    <style>
        body { margin: 0; font-family: sans-serif; display: flex; height: 100vh; background: #fff; }
        #canvas-container { flex: 1; position: relative; }
        #ui-panel { width: 350px; padding: 20px; border-left: 1px solid #ddd; overflow-y: auto; }
        .section { margin-bottom: 20px; border-bottom: 1px solid #eee; padding-bottom: 10px; }
        .hint { font-size: 11px; color: #666; background: #fff8e1; padding: 5px; border-radius: 4px; }
        .btn-main { width: 100%; padding: 10px; background: #007bff; color: white; border: none; cursor: pointer; border-radius: 5px; }
        #loader { position: absolute; inset: 0; background: white; display: flex; justify-content: center; align-items: center; z-index: 10; }
    </style>
</head>
<body>

<div id="loader">Ładowanie modelu 3D...</div>
<div id="canvas-container"></div>

<div id="ui-panel">
    <h2>Konfigurator</h2>
    
    <div class="section">
        <h3>Korpus (Sphere)</h3>
        <input type="color" onchange="changeColor('Sphere', this.value)" value="#ffffff">
    </div>

    <div class="section">
        <h3>Wstążka (Ribbon)</h3>
        <input type="color" onchange="changeColor('Ribbon', this.value)" value="#ff0000">
    </div>

    <div class="section">
        <h3>Logo</h3>
        <input type="file" accept="image/*" onchange="applyTexture('Logo', this)">
        <p class="hint">Zalecany PNG bez tła.</p>
    </div>

    <div class="section">
        <h3>Etykieta (Badge)</h3>
        <input type="file" accept="image/*" onchange="applyTexture('Badge', this)">
        <p class="hint">Zalecany kwadrat 512x512px.</p>
    </div>
</div>

<script src="https://unpkg.com/three@0.128.0/build/three.min.js"></script>
<script src="https://unpkg.com/three@0.128.0/examples/js/loaders/GLTFLoader.js"></script>
<script src="https://unpkg.com/three@0.128.0/examples/js/controls/OrbitControls.js"></script>

<script>
    let scene, camera, renderer, controls, model;
    
    // Używamy ścieżki względnej - dzięki temu działa i na GitHubie i lokalnie
    const MODEL_PATH = 'Bombka.glb'; 

    function init() {
        scene = new THREE.Scene();
        scene.background = new THREE.Color(0xffffff);

        camera = new THREE.PerspectiveCamera(45, (window.innerWidth - 350) / window.innerHeight, 0.1, 1000);
        camera.position.set(0, 0, 5);

        renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth - 350, window.innerHeight);
        renderer.outputEncoding = THREE.sRGBEncoding;
        document.getElementById('canvas-container').appendChild(renderer.domElement);

        scene.add(new THREE.AmbientLight(0xffffff, 0.8));
        const dirLight = new THREE.DirectionalLight(0xffffff, 0.5);
        dirLight.position.set(5, 10, 5);
        scene.add(dirLight);

        controls = new THREE.OrbitControls(camera, renderer.domElement);

        new THREE.GLTFLoader().load(MODEL_PATH, (gltf) => {
            model = gltf.scene;
            scene.add(model);
            document.getElementById('loader').style.display = 'none';
        });

        animate();
    }

    window.changeColor = (name, hex) => {
        model.traverse(node => {
            if (node.isMesh && node.name.toLowerCase().includes(name.toLowerCase())) {
                node.material.color = new THREE.Color(hex);
            }
        });
    };

    window.applyTexture = (name, input) => {
        const file = input.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = (e) => {
            new THREE.TextureLoader().load(e.target.result, (tex) => {
                tex.flipY = false;
                model.traverse(node => {
                    if (node.isMesh && node.name.toLowerCase().includes(name.toLowerCase())) {
                        node.material.map = tex;
                        node.material.needsUpdate = true;
                    }
                });
            });
        };
        reader.readAsDataURL(file);
    };

    function animate() {
        requestAnimationFrame(animate);
        if(controls) controls.update();
        renderer.render(scene, camera);
    }

    init();
</script>
</body>
</html>